<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.star.cinema.manage.dao.IManageDAO">
	<resultMap type="com.star.cinema.manage.dto.TimeInfoDTO" id="timeInfo">
		<result column="timeInfoNum" property="timeInfoNum"/>
		<result column="startTime" property="startTime"/>
		<result column="movieNum" property="movieNum"/>
		<result column="ticketDate" property="ticketDate"/>
	</resultMap>
	
	<resultMap type="com.star.cinema.manage.dto.HallDTO" id="hall">
		<result column="hallNum" property="hallNum"/>
		<result column="hallName" property="hallName"/>
	</resultMap>
	
	<resultMap type="com.star.cinema.manage.dto.CinemaDTO" id="cinema">
		<result column="cinemaNum" property="cinemaNum"/>
		<result column="countryName" property="countryName"/>
		<result column="cinemaName" property="cinemaName"/>
	</resultMap>
	
	<select id="timeInfoList" parameterType="com.star.cinema.manage.dto.TimeManageDTO" resultMap="timeInfo">
		SELECT B.* FROM(
			SELECT rownum rn, A.* FROM(
				SELECT * FROM timeinfo ORDER BY timeInfoNum DESC
			)A
		)B WHERE rn BETWEEN #{b} and #{e}
	</select>
	
	<select id="hallList" parameterType="com.star.cinema.manage.dto.HallDTO" resultMap="hall">
		SELECT B.* FROM(
			SELECT rownum rn, A.* FROM(
				SELECT * FROM hall ORDER BY hallNum DESC
			)A
		)B WHERE rn BETWEEN #{b} and #{e}
	</select>
	
	<select id="cinemaList" parameterType="com.star.cinema.manage.dto.CinemaDTO" resultMap="cinema">
		SELECT B.* FROM(
			SELECT rownum rn, A.* FROM(
				SELECT * FROM cinema ORDER BY cinemaNum DESC
			)A
		)B WHERE rn BETWEEN #{b} and #{e}
	</select>
	
	<select id="timeInfoCount" resultType="int">
		SELECT count(*) FROM timeinfo
	</select>
	
	<select id="cinemaName" resultType="int">
		SELECT cinemaNum FROM cinema WHERE cinemaName LIKE '%'||#{search}||'%'
	</select>
	
	<select id="timeSearch" parameterType="com.star.cinema.manage.dto.TimeManageDTO" resultMap="timeInfo">
		SELECT * FROM timeinfo WHERE cinemaNum=#{cinemaNum}
	</select>
	
	<select id="hallSearch" parameterType="com.star.cinema.manage.dto.HallDTO" resultMap="hall">
		SELECT * FROM hall WHERE cinemaNum=#{cinemaNum}
	</select>
	
	<select id="cinemaSearch" parameterType="com.star.cinema.manage.dto.CinemaDTO" resultMap="cinema">
		SELECT * FROM cinema WHERE cinemaNum=#{cinemaNum}
	</select>
	
	<select id="cinemaSearchForName" resultMap="cinema">
		SELECT * FROM cinema WHERE cinemaName LIKE '%'||#{search}||'%'
	</select>
	
	<select id="AllCinemaList" resultMap="cinema">
		SELECT * FROM cinema
	</select>
	
	<delete id="timeInfoDelete">
		DELETE from timeinfo WHERE cinemaNum=#{num}
	</delete>
	
	<delete id="hallDelete">
		DELETE from hall WHERE cinemaNum=#{num}
	</delete>
	
	<delete id="cinemaDelete">
		DELETE from cinema WHERE cinemaNum=#{num}
	</delete>
	
	<select id="cinemaCount" resultType="int">
		SELECT count(*) FROM cinema
	</select>
	
	<insert id="hallInsert" parameterType="com.star.cinema.manage.dto.HallDTO">
		INSERT INTO hall VALUES(hall_seq.nextval, #{hallName}, (SELECT MAX(cinemaNum) FROM cinema))
	</insert>
	
	<insert id="timeInfoInsert" parameterType="com.star.cinema.manage.dto.TimeInfoDTO">
		INSERT INTO timeinfo VALUES(time_seq.nextval, #{startTime}, (SELECT MAX(hallNum) FROM hall), (SELECT MAX(movieListNum) FROM movieList), #{ticketDate}, (SELECT MAX(cinemaNum) FROM cinema))
	</insert>
	
</mapper>